var KalturaPlayer="object"==typeof KalturaPlayer?KalturaPlayer:{};KalturaPlayer.cast=KalturaPlayer.cast||{},KalturaPlayer.cast.sender=function(e){var t={};function n(r){if(t[r])return t[r].exports;var a=t[r]={i:r,l:!1,exports:{}};return e[r].call(a.exports,a,a.exports,n),a.l=!0,a.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)n.d(r,a,function(t){return e[t]}.bind(null,a));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=1)}([function(e,t){e.exports=KalturaPlayer},function(e,t,n){"use strict";n.r(t),n.d(t,"RemotePlayer",(function(){return at})),n.d(t,"VERSION",(function(){return st})),n.d(t,"NAME",(function(){return ot}));var r=n(0);function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function o(e,t){return(o=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function s(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=l(e);if(t){var a=l(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return c(this,n)}}function c(e,t){return!t||"object"!==a(t)&&"function"!=typeof t?u(e):t}function u(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function l(e){return(l=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var f,y=r.core.State,d=r.core.FakeEvent,h=r.core.EventType,_=r.core.FakeEventTarget,p=r.core.StateType,v=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&o(e,t)}(c,e);var t,n,r,a=s(c);function c(e,t){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,c),(n=a.call(this))._remotePlayer=e,n._remotePlayerController=t,n._currentState=new y(p.IDLE),n._previousState=new y(p.IDLE),n._updateState=n._updateState.bind(u(n)),n._remotePlayerController.addEventListener(cast.framework.RemotePlayerEventType.PLAYER_STATE_CHANGED,n._updateState),n}return t=c,(n=[{key:"_updateState",value:function(){this._currentState.duration=Date.now()/1e3,this._previousState=this._currentState,this._remotePlayer.playerState?this._currentState=new y(this._remotePlayer.playerState.toLowerCase()):this._currentState=new y(p.IDLE),this.dispatchEvent(new d(h.PLAYER_STATE_CHANGED,{oldState:this.previousState,newState:this.currentState}))}},{key:"reset",value:function(){this._currentState=new y(p.IDLE),this._previousState=new y(p.IDLE)}},{key:"destroy",value:function(){this._remotePlayerController.removeEventListener(cast.framework.RemotePlayerEventType.PLAYER_STATE_CHANGED,this._updateState),this._currentState=new y(p.IDLE),this._previousState=new y(p.IDLE)}},{key:"currentState",get:function(){return this._currentState}},{key:"previousState",get:function(){return this._previousState}}])&&i(t.prototype,n),r&&i(t,r),c}(_);function g(e){return(g="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function m(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function k(e,t){return(k=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function E(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=S(e);if(t){var a=S(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return C(this,n)}}function C(e,t){return!t||"object"!==g(t)&&"function"!=typeof t?T(e):t}function T(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function S(e){return(S=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function b(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var P=r.cast.TextStyleConverter,A=r.core.Track,I=r.core.getLogger,w=r.core.TextStyle,R=r.core.AudioTrack,O=r.core.VideoTrack,D=r.core.TextTrack,M=r.core.Utils,L=r.core.TrackType,N=r.core.EventType,x=r.core.FakeEvent,j=r.core.FakeEventTarget,U=r.core.Error,G=(b(f={},L.AUDIO,R),b(f,L.VIDEO,O),b(f,L.TEXT,D),f),F=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&k(e,t)}(i,e);var t,n,r,a=E(i);function i(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),b(T(t=a.call(this)),"_activeTrackIds",[]),b(T(t),"_tracks",[]),t._remotePlayer=e,t._logger=I("CastTracksManager"),t._castSession=cast.framework.CastContext.getInstance().getCurrentSession(),t._textStyle=new w,t._bindEvents(),t}return t=i,(n=[{key:"parseTracks",value:function(){var e=this._remotePlayer.mediaInfo.tracks;if(e&&e.length>0){var t=e.filter((function(e){return e.type===chrome.cast.media.TrackType.TEXT})),n=e.filter((function(e){return e.type===chrome.cast.media.TrackType.VIDEO})),r=e.filter((function(e){return e.type===chrome.cast.media.TrackType.AUDIO})),a=this._parseTextTracks(t),i=this._parseVideoTracks(n),o=this._parseAudioTracks(r);this._tracks=o.concat(i).concat(a),this._addTextTrackOffOption()}this._logger.debug("Parse tracks",this._tracks),this._startOnMediaStatusUpdateInterval(),this.dispatchEvent(new x(N.TRACKS_CHANGED,{tracks:this._tracks}))}},{key:"getTracks",value:function(e){return M.Object.copyDeep(this._getTracksByType(e))}},{key:"getActiveTracks",value:function(){return M.Object.copyDeep({video:this._getTracksByType(L.VIDEO).find((function(e){return e.active})),audio:this._getTracksByType(L.AUDIO).find((function(e){return e.active})),text:this._getTracksByType(L.TEXT).find((function(e){return e.active}))})}},{key:"selectTrack",value:function(e){e instanceof O?this._selectVideoTrack(e):e instanceof R?this._selectAudioTrack(e):e instanceof D&&this._selectTextTrack(e)}},{key:"hideTextTrack",value:function(){var e=this._tracks.find((function(e){return"off"===e.language}));this.selectTrack(e)}},{key:"reset",value:function(){this._stopOnMediaStatusUpdateInterval(),this._tracks=[],this._activeTrackIds=[]}},{key:"destroy",value:function(){this._stopOnMediaStatusUpdateInterval(),this._tracks=[],this._activeTrackIds=[]}},{key:"_startOnMediaStatusUpdateInterval",value:function(){this._mediaStatusIntervalId||(this._mediaStatusIntervalId=setInterval(this._onMediaStatusUpdate,nt))}},{key:"_stopOnMediaStatusUpdateInterval",value:function(){this._mediaStatusIntervalId&&(clearInterval(this._mediaStatusIntervalId),this._mediaStatusIntervalId=null)}},{key:"_bindEvents",value:function(){this._onMediaStatusUpdate=this._onMediaStatusUpdate.bind(this)}},{key:"_parseTextTracks",value:function(e){var t=this,n=[],r=function(e){var t={id:e.trackId,index:e.trackId-1,label:e.name,language:e.language,kind:e.subType||"subtitles",active:!1};n.push(new D(t))},a=[],i=[];return e.forEach((function(e){e.trackContentId?i.push(e):a.push(e)})),a.forEach(r),i.forEach((function(e){a.some((function(t){return A.langComparer(e.language,t.language)}))?t._logger.warn("duplicated language, taking the inband option. Language: ",e.language):r(e)})),n}},{key:"_parseVideoTracks",value:function(e){var t=[];return e.forEach((function(e){var n={id:e.trackId,index:e.trackId-1,label:e.name,language:e.language,active:!1};t.push(new O(n))})),t}},{key:"_parseAudioTracks",value:function(e){var t=[];return e.forEach((function(e){var n={id:e.trackId,index:e.trackId-1,label:e.name,language:e.language,active:!1};t.push(new R(n))})),t}},{key:"_selectVideoTrack",value:function(e){var t=this;this._stopOnMediaStatusUpdateInterval();var n=this.getActiveTracks().video;this._selectTrack(e,n,(function(){t.dispatchEvent(new x(N.VIDEO_TRACK_CHANGED,{selectedVideoTrack:e})),t._startOnMediaStatusUpdateInterval()}),(function(e){t.dispatchEvent(new x(N.ERROR,new U(U.Severity.RECOVERABLE,U.Category.CAST,U.Code.EDIT_TRACKS_INFO_ERROR,e)))}))}},{key:"_selectAudioTrack",value:function(e){var t=this;this._stopOnMediaStatusUpdateInterval();var n=this.getActiveTracks().audio;this._selectTrack(e,n,(function(){t.dispatchEvent(new x(N.AUDIO_TRACK_CHANGED,{selectedAudioTrack:e})),t._startOnMediaStatusUpdateInterval()}),(function(e){t.dispatchEvent(new x(N.ERROR,new U(U.Severity.RECOVERABLE,U.Category.CAST,U.Code.CAST_EDIT_TRACKS_INFO_ERROR,e)))}))}},{key:"_selectTextTrack",value:function(e){var t=this;this._stopOnMediaStatusUpdateInterval();var n=this.getActiveTracks().text;this._selectTrack(e,n,(function(){t.dispatchEvent(new x(N.TEXT_TRACK_CHANGED,{selectedTextTrack:e})),t._startOnMediaStatusUpdateInterval()}),(function(e){t.dispatchEvent(new x(N.ERROR,new U(U.Severity.RECOVERABLE,U.Category.CAST,U.Code.EDIT_TRACKS_INFO_ERROR,e)))}))}},{key:"_selectTrack",value:function(e,t,n,r){var a=this;if(this._logger.debug("Select track",e,t,this._activeTrackIds),t){var i=this._activeTrackIds.indexOf(t.id);i>-1&&this._activeTrackIds.splice(i,1)}e.id&&"off"!==e.language&&this._activeTrackIds.push(e.id);var o=new chrome.cast.media.EditTracksInfoRequest(this._activeTrackIds);this._castSession.getMediaSession().editTracksInfo(o,(function(){a._logger.debug("Select track succeeded"),a._markActiveTrack(t,!1),a._markActiveTrack(e,!0),n()}),(function(e){a._logger.debug("Select track failed",e),r(e)}))}},{key:"_markActiveTrack",value:function(e,t){if(e){var n=e.id,r=e.language,a=this._tracks.find((function(e){return e.id===n||e.language===r&&"off"===r}));a&&(a.active=t)}}},{key:"_addTextTrackOffOption",value:function(){var e=this._getTracksByType(L.TEXT);e&&e.length&&this._tracks.push(new D({active:!0,index:e.length,kind:"subtitles",label:"Off",language:"off"}))}},{key:"_getTracksByType",value:function(e){return e?this._tracks.filter((function(t){return!e||!G[e]||t instanceof G[e]})):this._tracks}},{key:"_onMediaStatusUpdate",value:function(){var e,t,n=this,r=this._castSession.getMediaSession();if(r&&(!r.activeTrackIds||n._activeTrackIds.length===r.activeTrackIds.length&&n._activeTrackIds.every((function(e,t){return e===r.activeTrackIds[t]}))||r.activeTrackIds.filter((function(e){return!n._activeTrackIds.includes(e)})).forEach((function(e){var t=n._tracks.find((function(t){return t.id===e}));n.selectTrack(t)})),e=P.toCastTextStyle(n.textStyle),(t=r.media.textTrackStyle)&&(e.backgroundColor!==t.backgroundColor||e.fontFamily!==t.fontFamily||e.fontScale!==t.fontScale||e.foregroundColor!==t.foregroundColor))){var a=P.toPlayerTextStyle(r.media.textTrackStyle);this._textStyle=a,this.dispatchEvent(new x(N.TEXT_STYLE_CHANGED,{textStyle:a}))}}},{key:"textStyle",set:function(e){var t=this;this._logger.debug("Setting text style",e);var n=P.toCastTextStyle(e),r=new chrome.cast.media.EditTracksInfoRequest(null,n);this._castSession.getMediaSession().editTracksInfo(r,(function(){t._logger.debug("Setting text style succeed"),t._textStyle=e,t.dispatchEvent(new x(N.TEXT_STYLE_CHANGED,{textStyle:e}))}),(function(e){t._logger.debug("Setting text style failed",e),t.dispatchEvent(new x(N.ERROR,new U(U.Severity.RECOVERABLE,U.Category.CAST,U.Code.EDIT_TRACKS_INFO_ERROR,e)))}))},get:function(){return this._textStyle.clone()}}])&&m(t.prototype,n),r&&m(t,r),i}(j);function B(e){return(B="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function H(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function V(e,t){return(V=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function K(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=X(e);if(t){var a=X(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Y(this,n)}}function Y(e,t){return!t||"object"!==B(t)&&"function"!=typeof t?q(e):t}function q(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function X(e){return(X=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function W(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var z=r.core.EventType,J=r.core.FakeEvent,Q=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&V(e,t)}(i,e);var t,n,r,a=K(i);function i(e,t){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),W(q(n=a.call(this)),"_muted",!1),W(q(n),"_volume",1),W(q(n),"_paused",!1),W(q(n),"_currentTime",0),W(q(n),"_duration",0),W(q(n),"_seeking",!1),n._remotePlayer=e,n._remotePlayerController=t,n._bindEvents(),n._toggleListeners(!0),n}return t=i,(n=[{key:"reset",value:function(){this._toggleListeners(!1),clearInterval(this._liveCurrentTimeIntervalId),this._resetFlags(),this._toggleListeners(!0)}},{key:"destroy",value:function(){clearInterval(this._liveCurrentTimeIntervalId),this._toggleListeners(!1),this._muted=!1,this._volume=1,this._resetFlags()}},{key:"play",value:function(){this._remotePlayerController.playOrPause()}},{key:"pause",value:function(){this._remotePlayer.canPause&&this._remotePlayerController.playOrPause()}},{key:"_resetFlags",value:function(){this._paused=!1,this._currentTime=0,this._duration=0,this._seeking=!1}},{key:"_bindEvents",value:function(){this._onCurrentTimeChanged=this._onCurrentTimeChanged.bind(this),this._onIsPausedChanged=this._onIsPausedChanged.bind(this),this._onDurationChanged=this._onDurationChanged.bind(this),this._onVolumeLevelChanged=this._onVolumeLevelChanged.bind(this),this._onIsMutedChanged=this._onIsMutedChanged.bind(this),this._onIsMediaLoadedChanged=this._onIsMediaLoadedChanged.bind(this),this._onLiveCurrentTimeChanged=this._onLiveCurrentTimeChanged.bind(this)}},{key:"_toggleListeners",value:function(e){var t,n=this,r=(W(t={},cast.framework.RemotePlayerEventType.IS_MEDIA_LOADED_CHANGED,this._onIsMediaLoadedChanged),W(t,cast.framework.RemotePlayerEventType.IS_PAUSED_CHANGED,this._onIsPausedChanged),W(t,cast.framework.RemotePlayerEventType.DURATION_CHANGED,this._onDurationChanged),W(t,cast.framework.RemotePlayerEventType.VOLUME_LEVEL_CHANGED,this._onVolumeLevelChanged),W(t,cast.framework.RemotePlayerEventType.IS_MUTED_CHANGED,this._onIsMutedChanged),t);e?Object.keys(r).forEach((function(e){return n._remotePlayerController.addEventListener(e,r[e])})):(Object.keys(r).forEach((function(e){return n._remotePlayerController.removeEventListener(e,r[e])})),this._remotePlayerController.removeEventListener(cast.framework.RemotePlayerEventType.CURRENT_TIME_CHANGED,this._onCurrentTimeChanged))}},{key:"_onIsMediaLoadedChanged",value:function(e){var t=this;e.value&&this._remotePlayerController.addEventListener(cast.framework.RemotePlayerEventType.MEDIA_INFO_CHANGED,(function e(){t._remotePlayerController.removeEventListener(cast.framework.RemotePlayerEventType.MEDIA_INFO_CHANGED,e),t._remotePlayer.mediaInfo.streamType===chrome.cast.media.StreamType.LIVE?(t._mediaSession=cast.framework.CastContext.getInstance().getCurrentSession().getMediaSession(),t._liveCurrentTimeIntervalId=setInterval(t._onLiveCurrentTimeChanged,nt)):t._remotePlayerController.addEventListener(cast.framework.RemotePlayerEventType.CURRENT_TIME_CHANGED,t._onCurrentTimeChanged)}))}},{key:"_onCurrentTimeChanged",value:function(){this._currentTime=this._remotePlayer.currentTime,this._maybeDispatchTimeUpdate(),this._maybeEndPlayback()}},{key:"_onLiveCurrentTimeChanged",value:function(){this._currentTime=this._mediaSession.currentTime,this._maybeDispatchTimeUpdate(),this._maybeEndLivePlayback()}},{key:"_onIsPausedChanged",value:function(){this._paused=this._remotePlayer.isPaused,this._paused?this.dispatchEvent(new J(z.PAUSE)):this.dispatchEvent(new J(z.PLAY))}},{key:"_onDurationChanged",value:function(){this._duration=this._remotePlayer.duration,this.dispatchEvent(new J(z.DURATION_CHANGE))}},{key:"_onVolumeLevelChanged",value:function(){this._volume=this._remotePlayer.volumeLevel,this.dispatchEvent(new J(z.VOLUME_CHANGE))}},{key:"_onIsMutedChanged",value:function(){this._muted=this._remotePlayer.isMuted,this.dispatchEvent(new J(z.MUTE_CHANGE,{mute:this.muted}))}},{key:"_maybeDispatchTimeUpdate",value:function(){this._seeking?this._seekTargetTime&&(this._seekForward&&this.currentTime>=this._seekTargetTime||!this._seekForward&&this.currentTime<=this._seekTargetTime)&&(this._seeking=!1,this._seekTargetTime=null,this.dispatchEvent(new J(z.SEEKED)),this.dispatchEvent(new J(z.TIME_UPDATE))):this.dispatchEvent(new J(z.TIME_UPDATE))}},{key:"_maybeEndPlayback",value:function(){var e=Math.round(this._duration-this._currentTime);0!==this._currentTime&&0!==this._duration&&e<=1&&(this._currentTime=this._duration,this._paused=!0,this.dispatchEvent(new J(z.ENDED)))}},{key:"_maybeEndLivePlayback",value:function(){var e=this._mediaSession.liveSeekableRange;e&&e.isLiveDone&&(this._paused=!0,this.dispatchEvent(new J(z.ENDED)))}},{key:"muted",set:function(e){(e&&!this.muted||!e&&this.muted)&&this._remotePlayerController.muteOrUnmute()},get:function(){return this._muted}},{key:"volume",set:function(e){this._remotePlayer.canControlVolume&&(this._remotePlayer.volumeLevel=e,this._remotePlayerController.setVolumeLevel())},get:function(){return this._volume}},{key:"currentTime",set:function(e){this._remotePlayer.canSeek&&(this._seeking=!0,this.dispatchEvent(new J(z.SEEKING)),this._remotePlayer.currentTime=this._seekTargetTime=e,this._seekForward=e>this.currentTime,this._remotePlayerController.seek())},get:function(){return this._remotePlayer.savedPlayerState?this._remotePlayer.savedPlayerState.currentTime:this._currentTime}},{key:"duration",get:function(){return this._duration}},{key:"paused",get:function(){return this._remotePlayer.savedPlayerState?this._remotePlayer.savedPlayerState.isPaused:this._paused}},{key:"seeking",get:function(){return this._seeking}}])&&H(t.prototype,n),r&&H(t,r),i}(r.core.FakeEventTarget);function Z(e){return(Z="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function $(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function ee(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function te(e,t){return(te=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function ne(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=ae(e);if(t){var a=ae(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return re(this,n)}}function re(e,t){return!t||"object"!==Z(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function ae(e){return(ae=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var ie=r.ui.style,oe=r.ui.Components,se=r.ui.h,ce=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&te(e,t)}(i,e);var t,n,r,a=ne(i);function i(){return $(this,i),a.apply(this,arguments)}return t=i,(n=[{key:"playbackUI",value:function(e){return se("div",{className:ie.playbackGuiWrapper},se(oe.KeyboardControl,{player:e.player,config:e.config}),se(oe.Loading,{player:e.player}),se("div",{className:ie.playerGui,id:"player-gui"},se(oe.OverlayPortal,null),se(oe.BottomBar,null,se(oe.SeekBarPlaybackContainer,{showFramePreview:!0,showTimeBubble:!0,player:e.player,playerContainer:e.playerContainer}),se("div",{className:ie.leftControls},se(oe.PlaybackControls,{player:e.player}),se(oe.RewindControl,{player:e.player,step:10}),se(oe.ForwardControl,{player:e.player,step:10}),se(oe.TimeDisplayPlaybackContainer,{format:"current / total"})),se("div",{className:ie.rightControls},se(oe.VolumeControl,{player:e.player}),se(oe.LanguageControl,{player:e.player}),se(oe.CastControl,{player:e.player}),se(oe.FullscreenControl,{player:e.player}))),se(oe.CastOverlay,{player:e.player}),se(oe.OverlayAction,{player:e.player}),se(oe.PlaybackControls,{player:e.player})),se(oe.PrePlaybackPlayOverlay,{player:e.player}),se(oe.CastAfterPlay,{player:e.player}))}},{key:"liveUI",value:function(e){return se("div",{className:ie.playbackGuiWrapper},se(oe.KeyboardControl,{player:e.player,config:e.config}),se(oe.Loading,{player:e.player}),se("div",{className:ie.playerGui,id:"player-gui"},se(oe.OverlayPortal,null),se(oe.BottomBar,null,se(oe.SeekBarLivePlaybackContainer,{showFramePreview:!0,showTimeBubble:!0,player:e.player,playerContainer:e.playerContainer}),se("div",{className:ie.leftControls},se(oe.PlaybackControls,{player:e.player}),se(oe.LiveTag,{player:e.player})),se("div",{className:ie.rightControls},se(oe.VolumeControl,{player:e.player}),se(oe.LanguageControl,{player:e.player}),se(oe.CastControl,{player:e.player}),se(oe.FullscreenControl,{player:e.player}))),se(oe.CastOverlay,{player:e.player}),se(oe.OverlayAction,{player:e.player}),se(oe.PlaybackControls,{player:e.player})),se(oe.PrePlaybackPlayOverlay,{player:e.player}),se(oe.CastAfterPlay,{player:e.player}))}},{key:"idleUI",value:function(e){return se("div",{className:ie.playbackGuiWrapper},se(oe.Loading,{player:e.player}),se(oe.CastOverlay,{player:e.player}))}},{key:"adsUI",value:function(e){return se("div",{className:ie.adGuiWrapper},se(oe.KeyboardControl,{player:e.player,config:e.config}),se(oe.Loading,{player:e.player}),se("div",{className:ie.playerGui,id:"player-gui"},se(oe.CastOverlay,{player:e.player}),se(oe.OverlayAction,{player:e.player}),se("div",null,se(oe.TopBar,null,se("div",{className:ie.leftControls},se(oe.AdNotice,null)),se("div",{className:ie.rightControls},se(oe.AdLearnMore,null))),se(oe.AdSkip,{player:e.player})),se(oe.BottomBar,null,se("div",{className:ie.leftControls},se(oe.PlaybackControls,{player:e.player}),se(oe.TimeDisplayAdsContainer,null)),se("div",{className:ie.rightControls},se(oe.VolumeControl,{player:e.player}),se(oe.CastControl,{player:e.player}),se(oe.FullscreenControl,{player:e.player}))),se(oe.PlaybackControls,{player:e.player})))}}])&&ee(t.prototype,n),r&&ee(t,r),i}(r.cast.RemotePlayerUI);function ue(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var le,fe,ye,de=r.core.Utils,he=r.core.getLogger,_e=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,n,r;return t=e,r=[{key:"load",value:function(){return new Promise((function(t,n){window.__onGCastApiAvailable=function(n){return e._onGCastApiAvailable(n,t)},e._loadCastSDK().then((function(){return e._logger.debug("Cast sender lib has been loaded successfully")})).catch((function(t){e._logger.debug("Cast sender lib loading failed",t),n(t)}))}))}},{key:"_loadCastSDK",value:function(){return window.cast&&window.cast.framework?Promise.resolve():de.Dom.loadScriptAsync("//www.gstatic.com/cv/js/sender/v1/cast_sender.js?loadCastFramework=1")}},{key:"_onGCastApiAvailable",value:function(t,n){e._logger.debug("onGCastApiAvailable, isAvailable: ".concat(t.toString())),t?n():e._logger.debug("Google cast API isn't available yet")}}],(n=null)&&ue(t.prototype,n),r&&ue(t,r),e}();function pe(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}le=_e,fe="_logger",ye=he("CastLoader"),fe in le?Object.defineProperty(le,fe,{value:ye,enumerable:!0,configurable:!0,writable:!0}):le[fe]=ye;var ve=r.cast.CustomActionMessage,ge=r.cast.CustomActionType,me=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._castSession=cast.framework.CastContext.getInstance().getCurrentSession()}var t,n,r;return t=e,(n=[{key:"skipAd",value:function(){this._castSession.sendMessage(rt,new ve(ge.SKIP_AD))}}])&&pe(t.prototype,n),r&&pe(t,r),e}();function ke(e){return(ke="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Ee(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Ce(e,t){return(Ce=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Te(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Pe(e);if(t){var a=Pe(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Se(this,n)}}function Se(e,t){return!t||"object"!==ke(t)&&"function"!=typeof t?be(e):t}function be(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Pe(e){return(Pe=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Ae(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var Ie=r.core.EventManager,we=r.core.EventType,Re=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Ce(e,t)}(i,e);var t,n,r,a=Te(i);function i(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),Ae(be(t=a.call(this)),"_adBreak",!1),Ae(be(t),"_allAdsCompleted",!0),t._castPlayer=e,t._eventManager=new Ie,t._attachListeners(),t}return t=i,(n=[{key:"_attachListeners",value:function(){var e=this;this._eventManager.listen(this._castPlayer,we.AD_MANIFEST_LOADED,(function(){e._allAdsCompleted=!1})),this._eventManager.listen(this._castPlayer,we.AD_BREAK_START,(function(){e._adBreak=!0})),this._eventManager.listen(this._castPlayer,we.AD_BREAK_END,(function(){e._adBreak=!1})),this._eventManager.listen(this._castPlayer,we.ALL_ADS_COMPLETED,(function(){e._allAdsCompleted=!0}))}},{key:"reset",value:function(){this._eventManager.removeAll(),this._adBreak=!1,this._allAdsCompleted=!0,this._attachListeners()}},{key:"destroy",value:function(){this._adBreak=!1,this._allAdsCompleted=!0,this._eventManager.destroy()}},{key:"adBreak",get:function(){return this._adBreak}},{key:"allAdsCompleted",get:function(){return this._allAdsCompleted}}])&&Ee(t.prototype,n),r&&Ee(t,r),i}(r.core.FakeEventTarget);function Oe(e){return(Oe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function De(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Me(e,t,n){return t&&De(e.prototype,t),n&&De(e,n),e}function Le(e,t){return(Le=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Ne(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Ue(e);if(t){var a=Ue(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return xe(this,n)}}function xe(e,t){return!t||"object"!==Oe(t)&&"function"!=typeof t?je(e):t}function je(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Ue(e){return(Ue=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Ge(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var Fe=r.core.Env,Be=(r.core.Track,r.core.TextStyle,r.core.EventType),He=r.core.StateType,Ve=r.core.FakeEvent,Ke=r.core.Utils,Ye=r.core.EngineType,qe=r.core.AbrMode,Xe=r.core.Error,We=r.cast.BaseRemotePlayer,ze=r.cast.PlayerSnapshot,Je=(r.cast.RemoteControl,r.cast.RemoteConnectedPayload),Qe=r.cast.RemoteDisconnectedPayload,Ze=r.cast.RemoteAvailablePayload,$e=r.cast.RemoteSession,et=r.cast.TextStyleConverter,tt=r.cast.CustomMessageType,nt=(r.cast.CustomMessage,r.cast.CustomEventMessage,500),rt="urn:x-cast:com.kaltura.cast.playkit",at=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Le(e,t)}(n,e);var t=Ne(n);function n(e,r){var a;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n),Ge(je(a=t.call(this,"CastPlayer",e,r)),"_readyPromise",null),Ge(je(a),"_mediaInfo",null),Ge(je(a),"_firstPlay",!0),Ge(je(a),"_ended",!1),Ge(je(a),"_playbackStarted",!1),Ge(je(a),"_reset",!0),Ge(je(a),"_destroyed",!1),Ge(je(a),"_isOnLiveEdge",!1),_e.load().then((function(){a._initializeCastApi(),a._initializeRemotePlayer()})).catch((function(e){n._logger.error("Cast initialized error",e)})),a}return Me(n,null,[{key:"isSupported",value:function(){return"Chrome"===Fe.browser.name&&"iOS"!==Fe.os.name}}]),Me(n,[{key:"loadMedia",value:function(e,t){return n._logger.debug("Load media",e,t),this._mediaInfo=e,this._castMedia({mediaInfo:e},t)}},{key:"setMedia",value:function(e,t){n._logger.debug("Set media",e,t),this._castMedia({mediaConfig:e},t)}},{key:"getMediaInfo",value:function(){return Ke.Object.copyDeep(this._mediaInfo)}},{key:"getMediaConfig",value:function(){var e={sources:this._playerConfig.sources,plugins:this._playerConfig.plugins};return Ke.Object.copyDeep(e)}},{key:"ready",value:function(){return this._readyPromise?this._readyPromise:Promise.resolve()}},{key:"play",value:function(){!this.ended||this._adsManager.adBreak?this._engine.play():this._loadOrSetMedia({mediaInfo:this._mediaInfo,mediaConfig:this.getMediaConfig()})}},{key:"pause",value:function(){this._engine.pause()}},{key:"reset",value:function(){clearInterval(this._mediaInfoIntervalId),this._reset||(this._reset=!0,this._firstPlay=!0,this._ended=!1,this._isOnLiveEdge=!1,this._tracksManager.reset(),this._engine.reset(),this._adsManager.reset(),this._stateManager.reset(),this._readyPromise=this._createReadyPromise(),this.dispatchEvent(new Ve(Be.PLAYER_RESET)))}},{key:"destroy",value:function(){clearInterval(this._mediaInfoIntervalId),this._destroyed||(this._destroyed=!0,this._firstPlay=!0,this._ended=!1,this._isOnLiveEdge=!1,this._readyPromise=null,this._eventManager.destroy(),this._tracksManager.destroy(),this._engine.destroy(),this._adsManager.destroy(),this._stateManager.destroy(),this.dispatchEvent(new Ve(Be.PLAYER_DESTROY)))}},{key:"isLive",value:function(){var e=this._castRemotePlayer.mediaInfo;return!!e&&e.streamType===chrome.cast.media.StreamType.LIVE}},{key:"isOnLiveEdge",value:function(){return this._isOnLiveEdge}},{key:"isDvr",value:function(){if(this.isLive()){var e=this._castSession.getMediaSession();if(e){var t=e.liveSeekableRange;if(t){var n=t.start/60;return t.end/60-n>this._castConfig.liveEdgeThreshold}}}return!1}},{key:"seekToLiveEdge",value:function(){var e=this._castSession.getMediaSession();if(e){var t=e.liveSeekableRange;t&&(this._engine.currentTime=t.end)}}},{key:"getStartTimeOfDvrWindow",value:function(){var e=this._castSession.getMediaSession();if(e){var t=e.liveSeekableRange;if(t)return t.start}return 0}},{key:"getTracks",value:function(e){return this._tracksManager.getTracks(e)}},{key:"getActiveTracks",value:function(){return this._tracksManager.getActiveTracks()}},{key:"selectTrack",value:function(e){this._tracksManager.selectTrack(e)}},{key:"hideTextTrack",value:function(){this._tracksManager.hideTextTrack()}},{key:"startCasting",value:function(){return cast&&cast.framework?cast.framework.CastContext.getInstance().requestSession():Promise.reject()}},{key:"isCastAvailable",value:function(){return!!this._castRemotePlayer}},{key:"stopCasting",value:function(){this._castSession.endSession(!0)}},{key:"getCastSession",value:function(){return Ke.Object.copyDeep(this._remoteSession)}},{key:"_initializeCastApi",value:function(){var e=this,t={};t.receiverApplicationId=this._castConfig.receiverApplicationId||chrome.cast.media.DEFAULT_MEDIA_RECEIVER_APP_ID,t.autoJoinPolicy=this._castConfig.autoJoinPolicy||chrome.cast.AutoJoinPolicy.ORIGIN_SCOPED,n._logger.debug("Init cast API with options",t);var r=cast.framework.CastContext.getInstance();r.setOptions(t),r.addEventListener(cast.framework.CastContextEventType.CAST_STATE_CHANGED,(function(t){var n=new Ze(e,t.castState!==cast.framework.CastState.NO_DEVICES_AVAILABLE);e._remoteControl.onRemoteDeviceAvailable(n)}))}},{key:"_initializeRemotePlayer",value:function(){var e=this;this._castContext=cast.framework.CastContext.getInstance(),this._addSessionLifecycleListeners(),this._castRemotePlayer=new cast.framework.RemotePlayer,this._castRemotePlayerController=new cast.framework.RemotePlayerController(this._castRemotePlayer),this._castRemotePlayerController.addEventListener(cast.framework.RemotePlayerEventType.IS_CONNECTED_CHANGED,(function(){e._castRemotePlayer.isConnected?e._setupRemotePlayer():e._setupLocalPlayer()}))}},{key:"_setupRemotePlayer",value:function(){var e=this;n._logger.debug("Setup remote player"),this._castSession=cast.framework.CastContext.getInstance().getCurrentSession(),this._castSession.addMessageListener(rt,(function(t,n){return e._onCustomMessage(t,n)})),this._tracksManager=new F(this._castRemotePlayer),this._engine=new Q(this._castRemotePlayer,this._castRemotePlayerController),this._stateManager=new v(this._castRemotePlayer,this._castRemotePlayerController),this._adsManager=new Re(this),this._ui=new ce,this._attachListeners();var t=this._remoteControl.getPlayerSnapshot();this._playerConfig=t.config,this._remoteSession=new $e(this._castSession.getSessionId(),this._castSession.getCastDevice().friendlyName,this._castSession.getSessionState()!==cast.framework.SessionState.SESSION_STARTED);var r=new Je(this,this._remoteSession,this._ui);if(this._remoteControl.onRemoteDeviceConnected(r),!this._remoteSession.resuming||Fe.browser.major>=73&&"Android"===Fe.os.name){if(t){var a=this._getLoadOptions(t);this._loadOrSetMedia(t,a)}}else this._resumeSession()}},{key:"_loadOrSetMedia",value:function(e,t){var n=e.mediaInfo,r=e.mediaConfig;n?this.loadMedia(n,t):r&&this.setMedia({sources:e.mediaConfig.sources,plugins:{}},t)}},{key:"_castMedia",value:function(e,t){var n=this;this.reset(),this._remoteControl.getUIWrapper().reset(),this._playbackStarted&&this.dispatchEvent(new Ve(Be.CHANGE_SOURCE_STARTED));var r=new chrome.cast.media.MediaInfo,a=new chrome.cast.media.LoadRequest(r);return t&&Object.keys(t).forEach((function(e){"media"!==e?a[e]=t[e]:Object.keys(t.media).forEach((function(e){r[e]=t.media[e]}))})),r.customData=r.customData||{},r.customData.mediaInfo=e.mediaInfo,r.customData.mediaConfig=e.mediaConfig,this._castSession.loadMedia(a).then((function(){return n._onLoadMediaSuccess()}),(function(e){return n._onLoadMediaFailed(e)}))}},{key:"_setupLocalPlayer",value:function(){n._logger.debug("Setup local player");var e=new ze(this),t=new Qe(this,e);this.pause(),this.destroy(),this._remoteControl.onRemoteDeviceDisconnected(t)}},{key:"_createReadyPromise",value:function(){var e=this;this._readyPromise=new Promise((function(t){e._eventManager.listenOnce(e,Be.TRACKS_CHANGED,(function(){e.dispatchEvent(new Ve(Be.MEDIA_LOADED)),t()}))}))}},{key:"_attachListeners",value:function(){var e=this;this._eventManager.listen(this._engine,Be.TIME_UPDATE,(function(t){return e.dispatchEvent(t)})),this._eventManager.listen(this._engine,Be.PAUSE,(function(t){return e._onPause(t)})),this._eventManager.listen(this._engine,Be.PLAY,(function(t){return e.dispatchEvent(t)})),this._eventManager.listen(this._engine,Be.VOLUME_CHANGE,(function(t){return e.dispatchEvent(t)})),this._eventManager.listen(this._engine,Be.MUTE_CHANGE,(function(t){return e.dispatchEvent(t)})),this._eventManager.listen(this._engine,Be.DURATION_CHANGE,(function(t){return e.dispatchEvent(t)})),this._eventManager.listen(this._engine,Be.ENDED,(function(t){return e._onEnded(t)})),this._eventManager.listen(this._engine,Be.SEEKING,(function(t){return e.dispatchEvent(t)})),this._eventManager.listen(this._engine,Be.SEEKED,(function(t){return e.dispatchEvent(t)})),this._eventManager.listen(this._tracksManager,Be.TRACKS_CHANGED,(function(t){return e.dispatchEvent(t)})),this._eventManager.listen(this._tracksManager,Be.TEXT_TRACK_CHANGED,(function(t){return e.dispatchEvent(t)})),this._eventManager.listen(this._tracksManager,Be.VIDEO_TRACK_CHANGED,(function(t){return e.dispatchEvent(t)})),this._eventManager.listen(this._tracksManager,Be.AUDIO_TRACK_CHANGED,(function(t){return e.dispatchEvent(t)})),this._eventManager.listen(this._tracksManager,Be.TEXT_STYLE_CHANGED,(function(t){return e.dispatchEvent(t)})),this._eventManager.listen(this._tracksManager,Be.ERROR,(function(t){return e.dispatchEvent(t)})),this._eventManager.listen(this._stateManager,Be.PLAYER_STATE_CHANGED,(function(t){return e._onPlayerStateChanged(t)}))}},{key:"_onPause",value:function(e){var t=this;this._isOnLiveEdge=!1,this._eventManager.listenOnce(this._engine,Be.PLAY,(function(){t._isOnLiveEdge=!0})),this.dispatchEvent(e)}},{key:"_onEnded",value:function(e){var t=this;this._ended=!0,this.dispatchEvent(e),this._adsManager.allAdsCompleted?this.dispatchEvent(new Ve(Be.PLAYBACK_ENDED)):this._eventManager.listenOnce(this,Be.ALL_ADS_COMPLETED,(function(){t.dispatchEvent(new Ve(Be.PLAYBACK_ENDED))}))}},{key:"_onPlayerStateChanged",value:function(e){this._ended||(this._stateManager.currentState.type===He.PLAYING&&this.dispatchEvent(new Ve(Be.PLAYING)),this.dispatchEvent(e))}},{key:"_handleFirstPlay",value:function(){this._playbackStarted&&this.dispatchEvent(new Ve(Be.CHANGE_SOURCE_ENDED)),this.dispatchEvent(new Ve(Be.PLAYBACK_START)),this.dispatchEvent(new Ve(Be.PLAY)),this.dispatchEvent(new Ve(Be.FIRST_PLAY)),this.dispatchEvent(new Ve(Be.FIRST_PLAYING)),this.dispatchEvent(new Ve(Be.PLAYING)),this.paused&&this.dispatchEvent(new Ve(Be.PAUSE)),this._firstPlay=!1,this._playbackStarted=!0}},{key:"_resumeSession",value:function(){var e=this;this._readyPromise=this._createReadyPromise(),this._mediaInfoIntervalId=setInterval((function(){var t=e._castSession.getMediaSession();t&&t.customData&&(clearInterval(e._mediaInfoIntervalId),e._mediaInfo=t.customData.mediaInfo,n._logger.debug("Resuming session with media info",e._mediaInfo),e._onLoadMediaSuccess())}),nt)}},{key:"_onLoadMediaSuccess",value:function(){n._logger.debug("Load media success"),this._reset=!1,this._triggerInitialPlayerEvents(),this._tracksManager.parseTracks(),this._handleFirstPlay();var e=this._playerConfig.playback.startTime;this.isLive()&&(-1===e||"number"==typeof this.duration&&e>=this.duration-10)&&(this._isOnLiveEdge=!0)}},{key:"_triggerInitialPlayerEvents",value:function(){this.dispatchEvent(new Ve(Be.SOURCE_SELECTED,{selectedSource:[{url:this._castRemotePlayer.mediaInfo.contentUrl,mimetype:this._castRemotePlayer.mediaInfo.contentType}]})),this.dispatchEvent(new Ve(Be.LOADED_METADATA)),this.dispatchEvent(new Ve(Be.ABR_MODE_CHANGED,{mode:qe.AUTO}))}},{key:"_onLoadMediaFailed",value:function(e){n._logger.debug("Load media falied",e),this.dispatchEvent(new Ve(Be.ERROR,new Xe(Xe.Severity.CRITICAL,Xe.Category.CAST,Xe.Code.CAST_LOAD_MEDIA_FAILED,e)))}},{key:"_addSessionLifecycleListeners",value:function(){var e=this;this._castContext.addEventListener(cast.framework.CastContextEventType.SESSION_STATE_CHANGED,(function(t){switch(t.sessionState){case cast.framework.SessionState.SESSION_STARTING:e._remoteControl.onRemoteDeviceConnecting();break;case cast.framework.SessionState.SESSION_RESUMED:Fe.browser.major>=73&&"Android"===Fe.os.name&&e._remoteControl.onRemoteDeviceConnecting();break;case cast.framework.SessionState.SESSION_ENDING:e._remoteControl.onRemoteDeviceDisconnecting();break;case cast.framework.SessionState.SESSION_START_FAILED:e._remoteControl.onRemoteDeviceConnectFailed()}}))}},{key:"_getLoadOptions",value:function(e){var t={autoplay:this._playerConfig.playback.autoplay,currentTime:this._playerConfig.playback.startTime,media:{}};if(this.textStyle&&!this.textStyle.isEqual(e.textStyle)&&(t.media.textTrackStyle=et.toCastTextStyle(e.textStyle)),t.media.customData={audioLanguage:this._playerConfig.playback.audioLanguage,textLanguage:this._playerConfig.playback.textLanguage},e.advertising&&e.advertising.adTagUrl){this._adsController=new me;var n=this._castConfig.advertising;if(n&&n.vast){var r=Ke.Generator.uniqueId(5),a=Ke.Generator.uniqueId(5),i=[{id:r,position:0,vastAdsRequest:this._getAdsRequest(e.advertising)}],o=[{breakClipIds:[r],id:a,position:0}];t.media.breakClips=i,t.media.breaks=o}else t.media.vmapAdsRequest=this._getAdsRequest(e.advertising)}var s=this._getExternalCaptions();return s.length&&(t.media.tracks=s),t}},{key:"_getExternalCaptions",value:function(){var e=[];return this._playerConfig.sources.captions&&this._playerConfig.sources.captions.length&&this._playerConfig.sources.captions.forEach((function(t,r){var a;"vtt"===t.type||t.url.endsWith(".vtt")?(a=new chrome.cast.media.Track(r+1,chrome.cast.media.TrackType.TEXT),Ke.Object.mergeDeep(a,{trackContentId:t.url,trackContentType:"text/vtt",name:t.label,language:t.language}),e.push(a)):n._logger.warn("Text track type ".concat(t.type," is unsupported by Cast receiver"))})),e}},{key:"_getAdsRequest",value:function(e){var t={};return e.adTagUrl&&(t.adTagUrl=e.adTagUrl),e.adsResponse&&(t.adsResponse=e.adsResponse),t}},{key:"_onCustomMessage",value:function(e,t){try{var r=JSON.parse(t);switch(n._logger.debug("Custom message received",r),r.type){case tt.EVENT:this._handleCustomEvent(r)}}catch(e){this.dispatchEvent(new Ve(Be.ERROR,new Xe(Xe.Severity.RECOVERABLE,Xe.Category.CAST,Xe.Code.CAST_CUSTOM_MESSAGE_PARSING_ERROR,e)))}}},{key:"_handleCustomEvent",value:function(e){this.dispatchEvent(new Ve(e.event,e.payload))}},{key:"ads",get:function(){return this._adsController}},{key:"textStyle",set:function(e){this._tracksManager.textStyle=e},get:function(){return this._tracksManager.textStyle}},{key:"currentTime",set:function(e){this._engine.currentTime=e},get:function(){return this._engine.currentTime}},{key:"duration",get:function(){return this._engine.duration}},{key:"volume",set:function(e){this._engine.volume=e},get:function(){return this._engine.volume}},{key:"paused",get:function(){return this._engine.paused}},{key:"ended",get:function(){return this._ended}},{key:"seeking",get:function(){return this._engine.seeking}},{key:"muted",set:function(e){this._engine.muted=e},get:function(){return this._engine.muted}},{key:"src",get:function(){return this._castRemotePlayer.mediaInfo?this._castRemotePlayer.mediaInfo.contentUrl:""}},{key:"poster",get:function(){try{return this._castRemotePlayer.mediaInfo.metadata.images[0].url}catch(e){return""}}},{key:"playbackRate",get:function(){var e=this._castSession.getMediaSession();return e?e.playbackRate:null}},{key:"engineType",get:function(){return Ye.CAST}},{key:"type",get:function(){return n.Type}}]),n}(We);Ge(at,"Type","chromecast"),Ge(at,"defaultConfig",{liveEdgeThreshold:5});var it=r.cast.registerRemotePlayer,ot="@playkit-js/playkit-js-cast-sender",st="1.0.1";at.isSupported()&&it(at.Type,at)}]);
//# sourceMappingURL=playkit-cast-sender.js.map