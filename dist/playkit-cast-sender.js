var KalturaPlayer="object"==typeof KalturaPlayer?KalturaPlayer:{};KalturaPlayer.cast=KalturaPlayer.cast||{},KalturaPlayer.cast.sender=function(e){var t={};function a(n){if(t[n])return t[n].exports;var r=t[n]={i:n,l:!1,exports:{}};return e[n].call(r.exports,r,r.exports,a),r.l=!0,r.exports}return a.m=e,a.c=t,a.d=function(e,t,n){a.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},a.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.t=function(e,t){if(1&t&&(e=a(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(a.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)a.d(n,r,function(t){return e[t]}.bind(null,r));return n},a.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return a.d(t,"a",t),t},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.p="",a(a.s=1)}([function(e,t){e.exports=KalturaPlayer},function(e,t,a){"use strict";a.r(t),a.d(t,"RemotePlayer",(function(){return Te})),a.d(t,"VERSION",(function(){return Ae})),a.d(t,"NAME",(function(){return Se}));var n=a(0);function r(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var i,s=n.core.State,o=n.core.FakeEvent,c=n.core.EventType,l=n.core.FakeEventTarget,u=n.core.StateType,d=function(e){var t,a;function n(t,a){var n;return(n=e.call(this)||this)._remotePlayer=t,n._remotePlayerController=a,n._currentState=new s(u.IDLE),n._previousState=new s(u.IDLE),n._updateState=n._updateState.bind(function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(n)),n._remotePlayerController.addEventListener(cast.framework.RemotePlayerEventType.PLAYER_STATE_CHANGED,n._updateState),n}a=e,(t=n).prototype=Object.create(a.prototype),t.prototype.constructor=t,t.__proto__=a;var i,l,d,_=n.prototype;return _._updateState=function(){this._currentState.duration=Date.now()/1e3,this._previousState=this._currentState,this._remotePlayer.playerState?this._currentState=new s(this._remotePlayer.playerState.toLowerCase()):this._currentState=new s(u.IDLE),this.dispatchEvent(new o(c.PLAYER_STATE_CHANGED,{oldState:this.previousState,newState:this.currentState}))},_.reset=function(){this._currentState=new s(u.IDLE),this._previousState=new s(u.IDLE)},_.destroy=function(){this._remotePlayerController.removeEventListener(cast.framework.RemotePlayerEventType.PLAYER_STATE_CHANGED,this._updateState),this._currentState=new s(u.IDLE),this._previousState=new s(u.IDLE)},i=n,(l=[{key:"currentState",get:function(){return this._currentState}},{key:"previousState",get:function(){return this._previousState}}])&&r(i.prototype,l),d&&r(i,d),n}(l);function _(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function h(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function y(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}var p=n.cast.TextStyleConverter,g=n.core.Track,f=n.core.getLogger,v=n.core.TextStyle,m=n.core.AudioTrack,E=n.core.VideoTrack,C=n.core.TextTrack,T=n.core.Utils,k=n.core.TrackType,S=n.core.EventType,A=n.core.FakeEvent,P=n.core.FakeEventTarget,I=n.core.Error,b=((i={})[k.AUDIO]=m,i[k.VIDEO]=E,i[k.TEXT]=C,i),R=function(e){var t,a;function n(t){var a;return y(h(a=e.call(this)||this),"_activeTrackIds",[]),y(h(a),"_tracks",[]),a._remotePlayer=t,a._logger=f("CastTracksManager"),a._castSession=cast.framework.CastContext.getInstance().getCurrentSession(),a._textStyle=new v,a._bindEvents(),a}a=e,(t=n).prototype=Object.create(a.prototype),t.prototype.constructor=t,t.__proto__=a;var r,i,s,o=n.prototype;return o.parseTracks=function(){var e=this._remotePlayer.mediaInfo.tracks;if(e&&e.length>0){var t=e.filter((function(e){return e.type===chrome.cast.media.TrackType.TEXT})),a=e.filter((function(e){return e.type===chrome.cast.media.TrackType.VIDEO})),n=e.filter((function(e){return e.type===chrome.cast.media.TrackType.AUDIO})),r=this._parseTextTracks(t),i=this._parseVideoTracks(a),s=this._parseAudioTracks(n);this._tracks=s.concat(i).concat(r),this._addTextTrackOffOption()}this._logger.debug("Parse tracks",this._tracks),this._startOnMediaStatusUpdateInterval(),this.dispatchEvent(new A(S.TRACKS_CHANGED,{tracks:this._tracks}))},o.getTracks=function(e){return T.Object.copyDeep(this._getTracksByType(e))},o.getActiveTracks=function(){return T.Object.copyDeep({video:this._getTracksByType(k.VIDEO).find((function(e){return e.active})),audio:this._getTracksByType(k.AUDIO).find((function(e){return e.active})),text:this._getTracksByType(k.TEXT).find((function(e){return e.active}))})},o.selectTrack=function(e){e instanceof E?this._selectVideoTrack(e):e instanceof m?this._selectAudioTrack(e):e instanceof C&&this._selectTextTrack(e)},o.hideTextTrack=function(){var e=this._tracks.find((function(e){return"off"===e.language}));this.selectTrack(e)},o.reset=function(){this._stopOnMediaStatusUpdateInterval(),this._tracks=[],this._activeTrackIds=[]},o.destroy=function(){this._stopOnMediaStatusUpdateInterval(),this._tracks=[],this._activeTrackIds=[]},o._startOnMediaStatusUpdateInterval=function(){this._mediaStatusIntervalId||(this._mediaStatusIntervalId=setInterval(this._onMediaStatusUpdate,Ee))},o._stopOnMediaStatusUpdateInterval=function(){this._mediaStatusIntervalId&&(clearInterval(this._mediaStatusIntervalId),this._mediaStatusIntervalId=null)},o._bindEvents=function(){this._onMediaStatusUpdate=this._onMediaStatusUpdate.bind(this)},o._parseTextTracks=function(e){var t=this,a=[],n=function(e){var t={id:e.trackId,index:e.trackId-1,label:e.name,language:e.language,kind:e.subType||"subtitles",active:!1};a.push(new C(t))},r=[],i=[];return e.forEach((function(e){e.trackContentId?i.push(e):r.push(e)})),r.forEach(n),i.forEach((function(e){r.some((function(t){return g.langComparer(e.language,t.language)}))?t._logger.warn("duplicated language, taking the inband option. Language: ",e.language):n(e)})),a},o._parseVideoTracks=function(e){var t=[];return e.forEach((function(e){var a={id:e.trackId,index:e.trackId-1,label:e.name,language:e.language,active:!1};t.push(new E(a))})),t},o._parseAudioTracks=function(e){var t=[];return e.forEach((function(e){var a={id:e.trackId,index:e.trackId-1,label:e.name,language:e.language,active:!1};t.push(new m(a))})),t},o._selectVideoTrack=function(e){var t=this;this._stopOnMediaStatusUpdateInterval();var a=this.getActiveTracks().video;this._selectTrack(e,a,(function(){t.dispatchEvent(new A(S.VIDEO_TRACK_CHANGED,{selectedVideoTrack:e})),t._startOnMediaStatusUpdateInterval()}),(function(e){t.dispatchEvent(new A(S.ERROR,new I(I.Severity.RECOVERABLE,I.Category.CAST,I.Code.EDIT_TRACKS_INFO_ERROR,e)))}))},o._selectAudioTrack=function(e){var t=this;this._stopOnMediaStatusUpdateInterval();var a=this.getActiveTracks().audio;this._selectTrack(e,a,(function(){t.dispatchEvent(new A(S.AUDIO_TRACK_CHANGED,{selectedAudioTrack:e})),t._startOnMediaStatusUpdateInterval()}),(function(e){t.dispatchEvent(new A(S.ERROR,new I(I.Severity.RECOVERABLE,I.Category.CAST,I.Code.CAST_EDIT_TRACKS_INFO_ERROR,e)))}))},o._selectTextTrack=function(e){var t=this;this._stopOnMediaStatusUpdateInterval();var a=this.getActiveTracks().text;this._selectTrack(e,a,(function(){t.dispatchEvent(new A(S.TEXT_TRACK_CHANGED,{selectedTextTrack:e})),t._startOnMediaStatusUpdateInterval()}),(function(e){t.dispatchEvent(new A(S.ERROR,new I(I.Severity.RECOVERABLE,I.Category.CAST,I.Code.EDIT_TRACKS_INFO_ERROR,e)))}))},o._selectTrack=function(e,t,a,n){var r=this;if(this._logger.debug("Select track",e,t,this._activeTrackIds),t){var i=this._activeTrackIds.indexOf(t.id);i>-1&&this._activeTrackIds.splice(i,1)}e.id&&"off"!==e.language&&this._activeTrackIds.push(e.id);var s=new chrome.cast.media.EditTracksInfoRequest(this._activeTrackIds);this._castSession.getMediaSession().editTracksInfo(s,(function(){r._logger.debug("Select track succeeded"),r._markActiveTrack(t,!1),r._markActiveTrack(e,!0),a()}),(function(e){r._logger.debug("Select track failed",e),n(e)}))},o._markActiveTrack=function(e,t){if(e){var a=e.id,n=e.language,r=this._tracks.find((function(e){return e.id===a||e.language===n&&"off"===n}));r&&(r.active=t)}},o._addTextTrackOffOption=function(){var e=this._getTracksByType(k.TEXT);e&&e.length&&this._tracks.push(new C({active:!0,index:e.length,kind:"subtitles",label:"Off",language:"off"}))},o._getTracksByType=function(e){return e?this._tracks.filter((function(t){return!e||!b[e]||t instanceof b[e]})):this._tracks},o._onMediaStatusUpdate=function(){var e,t,a=this,n=this._castSession.getMediaSession();if(n){if(!(!n.activeTrackIds||a._activeTrackIds.length===n.activeTrackIds.length&&a._activeTrackIds.every((function(e,t){return e===n.activeTrackIds[t]}))))n.activeTrackIds.filter((function(e){return!a._activeTrackIds.includes(e)})).forEach((function(e){var t=a._tracks.find((function(t){return t.id===e}));a.selectTrack(t)}));if(e=p.toCastTextStyle(a.textStyle),(t=n.media.textTrackStyle)&&(e.backgroundColor!==t.backgroundColor||e.fontFamily!==t.fontFamily||e.fontScale!==t.fontScale||e.foregroundColor!==t.foregroundColor)){var r=p.toPlayerTextStyle(n.media.textTrackStyle);this._textStyle=r,this.dispatchEvent(new A(S.TEXT_STYLE_CHANGED,{textStyle:r}))}}},r=n,(i=[{key:"textStyle",set:function(e){var t=this;this._logger.debug("Setting text style",e);var a=p.toCastTextStyle(e),n=new chrome.cast.media.EditTracksInfoRequest(null,a);this._castSession.getMediaSession().editTracksInfo(n,(function(){t._logger.debug("Setting text style succeed"),t._textStyle=e,t.dispatchEvent(new A(S.TEXT_STYLE_CHANGED,{textStyle:e}))}),(function(e){t._logger.debug("Setting text style failed",e),t.dispatchEvent(new A(S.ERROR,new I(I.Severity.RECOVERABLE,I.Category.CAST,I.Code.EDIT_TRACKS_INFO_ERROR,e)))}))},get:function(){return this._textStyle.clone()}}])&&_(r.prototype,i),s&&_(r,s),n}(P);function w(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function D(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function M(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}var O=n.core.EventType,L=n.core.FakeEvent,N=function(e){var t,a;function n(t,a){var n;return M(D(n=e.call(this)||this),"_muted",!1),M(D(n),"_volume",1),M(D(n),"_paused",!1),M(D(n),"_currentTime",0),M(D(n),"_duration",0),M(D(n),"_seeking",!1),n._remotePlayer=t,n._remotePlayerController=a,n._bindEvents(),n._toggleListeners(!0),n}a=e,(t=n).prototype=Object.create(a.prototype),t.prototype.constructor=t,t.__proto__=a;var r,i,s,o=n.prototype;return o.reset=function(){this._toggleListeners(!1),clearInterval(this._liveCurrentTimeIntervalId),this._resetFlags(),this._toggleListeners(!0)},o.destroy=function(){clearInterval(this._liveCurrentTimeIntervalId),this._toggleListeners(!1),this._muted=!1,this._volume=1,this._resetFlags()},o.play=function(){this._remotePlayerController.playOrPause()},o.pause=function(){this._remotePlayer.canPause&&this._remotePlayerController.playOrPause()},o._resetFlags=function(){this._paused=!1,this._currentTime=0,this._duration=0,this._seeking=!1},o._bindEvents=function(){this._onCurrentTimeChanged=this._onCurrentTimeChanged.bind(this),this._onIsPausedChanged=this._onIsPausedChanged.bind(this),this._onDurationChanged=this._onDurationChanged.bind(this),this._onVolumeLevelChanged=this._onVolumeLevelChanged.bind(this),this._onIsMutedChanged=this._onIsMutedChanged.bind(this),this._onIsMediaLoadedChanged=this._onIsMediaLoadedChanged.bind(this),this._onLiveCurrentTimeChanged=this._onLiveCurrentTimeChanged.bind(this)},o._toggleListeners=function(e){var t,a=this,n=((t={})[cast.framework.RemotePlayerEventType.IS_MEDIA_LOADED_CHANGED]=this._onIsMediaLoadedChanged,t[cast.framework.RemotePlayerEventType.IS_PAUSED_CHANGED]=this._onIsPausedChanged,t[cast.framework.RemotePlayerEventType.DURATION_CHANGED]=this._onDurationChanged,t[cast.framework.RemotePlayerEventType.VOLUME_LEVEL_CHANGED]=this._onVolumeLevelChanged,t[cast.framework.RemotePlayerEventType.IS_MUTED_CHANGED]=this._onIsMutedChanged,t);e?Object.keys(n).forEach((function(e){return a._remotePlayerController.addEventListener(e,n[e])})):(Object.keys(n).forEach((function(e){return a._remotePlayerController.removeEventListener(e,n[e])})),this._remotePlayerController.removeEventListener(cast.framework.RemotePlayerEventType.CURRENT_TIME_CHANGED,this._onCurrentTimeChanged))},o._onIsMediaLoadedChanged=function(e){var t=this;e.value&&this._remotePlayerController.addEventListener(cast.framework.RemotePlayerEventType.MEDIA_INFO_CHANGED,(function e(){t._remotePlayerController.removeEventListener(cast.framework.RemotePlayerEventType.MEDIA_INFO_CHANGED,e),t._remotePlayer.mediaInfo.streamType===chrome.cast.media.StreamType.LIVE?(t._mediaSession=cast.framework.CastContext.getInstance().getCurrentSession().getMediaSession(),t._liveCurrentTimeIntervalId=setInterval(t._onLiveCurrentTimeChanged,Ee)):t._remotePlayerController.addEventListener(cast.framework.RemotePlayerEventType.CURRENT_TIME_CHANGED,t._onCurrentTimeChanged)}))},o._onCurrentTimeChanged=function(){this._currentTime=this._remotePlayer.currentTime,this._maybeDispatchTimeUpdate(),this._maybeEndPlayback()},o._onLiveCurrentTimeChanged=function(){this._currentTime=this._mediaSession.currentTime,this._maybeDispatchTimeUpdate(),this._maybeEndLivePlayback()},o._onIsPausedChanged=function(){this._paused=this._remotePlayer.isPaused,this._paused?this.dispatchEvent(new L(O.PAUSE)):this.dispatchEvent(new L(O.PLAY))},o._onDurationChanged=function(){this._duration=this._remotePlayer.duration,this.dispatchEvent(new L(O.DURATION_CHANGE))},o._onVolumeLevelChanged=function(){this._volume=this._remotePlayer.volumeLevel,this.dispatchEvent(new L(O.VOLUME_CHANGE))},o._onIsMutedChanged=function(){this._muted=this._remotePlayer.isMuted,this.dispatchEvent(new L(O.MUTE_CHANGE,{mute:this.muted}))},o._maybeDispatchTimeUpdate=function(){this._seeking?this._seekTargetTime&&(this._seekForward&&this.currentTime>=this._seekTargetTime||!this._seekForward&&this.currentTime<=this._seekTargetTime)&&(this._seeking=!1,this._seekTargetTime=null,this.dispatchEvent(new L(O.SEEKED)),this.dispatchEvent(new L(O.TIME_UPDATE))):this.dispatchEvent(new L(O.TIME_UPDATE))},o._maybeEndPlayback=function(){var e=Math.round(this._duration-this._currentTime);0!==this._currentTime&&0!==this._duration&&e<=1&&(this._currentTime=this._duration,this._paused=!0,this.dispatchEvent(new L(O.ENDED)))},o._maybeEndLivePlayback=function(){var e=this._mediaSession.liveSeekableRange;e&&e.isLiveDone&&(this._paused=!0,this.dispatchEvent(new L(O.ENDED)))},r=n,(i=[{key:"muted",set:function(e){(e&&!this.muted||!e&&this.muted)&&this._remotePlayerController.muteOrUnmute()},get:function(){return this._muted}},{key:"volume",set:function(e){this._remotePlayer.canControlVolume&&(this._remotePlayer.volumeLevel=e,this._remotePlayerController.setVolumeLevel())},get:function(){return this._volume}},{key:"currentTime",set:function(e){this._remotePlayer.canSeek&&(this._seeking=!0,this.dispatchEvent(new L(O.SEEKING)),this._remotePlayer.currentTime=this._seekTargetTime=e,this._seekForward=e>this.currentTime,this._remotePlayerController.seek())},get:function(){return this._remotePlayer.savedPlayerState?this._remotePlayer.savedPlayerState.currentTime:this._currentTime}},{key:"duration",get:function(){return this._duration}},{key:"paused",get:function(){return this._remotePlayer.savedPlayerState?this._remotePlayer.savedPlayerState.isPaused:this._paused}},{key:"seeking",get:function(){return this._seeking}}])&&w(r.prototype,i),s&&w(r,s),n}(n.core.FakeEventTarget);var x=n.ui.style,U=n.ui.Components,G=n.ui.h,j=function(e){var t,a;function n(){return e.apply(this,arguments)||this}a=e,(t=n).prototype=Object.create(a.prototype),t.prototype.constructor=t,t.__proto__=a;var r=n.prototype;return r.playbackUI=function(e){return G("div",{className:x.playbackGuiWrapper},G(U.KeyboardControl,{player:e.player,config:e.config}),G(U.Loading,{player:e.player}),G("div",{className:x.playerGui,id:"player-gui"},G(U.OverlayPortal,null),G(U.BottomBar,null,G(U.SeekBarPlaybackContainer,{showFramePreview:!0,showTimeBubble:!0,player:e.player,playerContainer:e.playerContainer}),G("div",{className:x.leftControls},G(U.PlaybackControls,{player:e.player}),G(U.RewindControl,{player:e.player,step:10}),G(U.ForwardControl,{player:e.player,step:10}),G(U.TimeDisplayPlaybackContainer,{format:"current / total"})),G("div",{className:x.rightControls},G(U.VolumeControl,{player:e.player}),G(U.LanguageControl,{player:e.player}),G(U.CastControl,{player:e.player}),G(U.FullscreenControl,{player:e.player}))),G(U.CastOverlay,{player:e.player}),G(U.OverlayAction,{player:e.player}),G(U.PlaybackControls,{player:e.player})),G(U.PrePlaybackPlayOverlay,{player:e.player}),G(U.CastAfterPlay,{player:e.player}))},r.liveUI=function(e){return G("div",{className:x.playbackGuiWrapper},G(U.KeyboardControl,{player:e.player,config:e.config}),G(U.Loading,{player:e.player}),G("div",{className:x.playerGui,id:"player-gui"},G(U.OverlayPortal,null),G(U.BottomBar,null,G(U.SeekBarLivePlaybackContainer,{showFramePreview:!0,showTimeBubble:!0,player:e.player,playerContainer:e.playerContainer}),G("div",{className:x.leftControls},G(U.PlaybackControls,{player:e.player}),G(U.LiveTag,{player:e.player})),G("div",{className:x.rightControls},G(U.VolumeControl,{player:e.player}),G(U.LanguageControl,{player:e.player}),G(U.CastControl,{player:e.player}),G(U.FullscreenControl,{player:e.player}))),G(U.CastOverlay,{player:e.player}),G(U.OverlayAction,{player:e.player}),G(U.PlaybackControls,{player:e.player})),G(U.PrePlaybackPlayOverlay,{player:e.player}),G(U.CastAfterPlay,{player:e.player}))},r.idleUI=function(e){return G("div",{className:x.playbackGuiWrapper},G(U.Loading,{player:e.player}),G(U.CastOverlay,{player:e.player}))},r.adsUI=function(e){return G("div",{className:x.adGuiWrapper},G(U.KeyboardControl,{player:e.player,config:e.config}),G(U.Loading,{player:e.player}),G("div",{className:x.playerGui,id:"player-gui"},G(U.CastOverlay,{player:e.player}),G(U.OverlayAction,{player:e.player}),G("div",null,G(U.TopBar,null,G("div",{className:x.leftControls},G(U.AdNotice,null)),G("div",{className:x.rightControls},G(U.AdLearnMore,null))),G(U.AdSkip,{player:e.player})),G(U.BottomBar,null,G("div",{className:x.leftControls},G(U.PlaybackControls,{player:e.player}),G(U.TimeDisplayAdsContainer,null)),G("div",{className:x.rightControls},G(U.VolumeControl,{player:e.player}),G(U.CastControl,{player:e.player}),G(U.FullscreenControl,{player:e.player}))),G(U.PlaybackControls,{player:e.player})))},n}(n.cast.RemotePlayerUI);var F,B,H,V=n.core.Utils,K=n.core.getLogger,Y=function(){function e(){}return e.load=function(){return new Promise((function(t,a){window.__onGCastApiAvailable=function(a){return e._onGCastApiAvailable(a,t)},e._loadCastSDK().then((function(){return e._logger.debug("Cast sender lib has been loaded successfully")})).catch((function(t){e._logger.debug("Cast sender lib loading failed",t),a(t)}))}))},e._loadCastSDK=function(){return window.cast&&window.cast.framework?Promise.resolve():V.Dom.loadScriptAsync("//www.gstatic.com/cv/js/sender/v1/cast_sender.js?loadCastFramework=1")},e._onGCastApiAvailable=function(t,a){e._logger.debug("onGCastApiAvailable, isAvailable: "+t.toString()),t?a():e._logger.debug("Google cast API isn't available yet")},e}();F=Y,B="_logger",H=K("CastLoader"),B in F?Object.defineProperty(F,B,{value:H,enumerable:!0,configurable:!0,writable:!0}):F[B]=H;var q=n.cast.CustomActionMessage,X=n.cast.CustomActionType,W=function(){function e(){this._castSession=cast.framework.CastContext.getInstance().getCurrentSession()}return e.prototype.skipAd=function(){this._castSession.sendMessage(Ce,new q(X.SKIP_AD))},e}();function z(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function J(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Q(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}var Z=n.core.EventManager,$=n.core.EventType,ee=function(e){var t,a;function n(t){var a;return Q(J(a=e.call(this)||this),"_adBreak",!1),Q(J(a),"_allAdsCompleted",!0),a._castPlayer=t,a._eventManager=new Z,a._attachListeners(),a}a=e,(t=n).prototype=Object.create(a.prototype),t.prototype.constructor=t,t.__proto__=a;var r,i,s,o=n.prototype;return o._attachListeners=function(){var e=this;this._eventManager.listen(this._castPlayer,$.AD_MANIFEST_LOADED,(function(){e._allAdsCompleted=!1})),this._eventManager.listen(this._castPlayer,$.AD_BREAK_START,(function(){e._adBreak=!0})),this._eventManager.listen(this._castPlayer,$.AD_BREAK_END,(function(){e._adBreak=!1})),this._eventManager.listen(this._castPlayer,$.ALL_ADS_COMPLETED,(function(){e._allAdsCompleted=!0}))},o.reset=function(){this._eventManager.removeAll(),this._adBreak=!1,this._allAdsCompleted=!0,this._attachListeners()},o.destroy=function(){this._adBreak=!1,this._allAdsCompleted=!0,this._eventManager.destroy()},r=n,(i=[{key:"adBreak",get:function(){return this._adBreak}},{key:"allAdsCompleted",get:function(){return this._allAdsCompleted}}])&&z(r.prototype,i),s&&z(r,s),n}(n.core.FakeEventTarget);function te(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function ae(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function ne(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}var re=n.core.Env,ie=(n.core.Track,n.core.TextStyle,n.core.EventType),se=n.core.StateType,oe=n.core.FakeEvent,ce=n.core.Utils,le=n.core.EngineType,ue=n.core.AbrMode,de=n.core.Error,_e=n.cast.BaseRemotePlayer,he=n.cast.PlayerSnapshot,ye=(n.cast.RemoteControl,n.cast.RemoteConnectedPayload),pe=n.cast.RemoteDisconnectedPayload,ge=n.cast.RemoteAvailablePayload,fe=n.cast.RemoteSession,ve=n.cast.TextStyleConverter,me=n.cast.CustomMessageType,Ee=(n.cast.CustomMessage,n.cast.CustomEventMessage,500),Ce="urn:x-cast:com.kaltura.cast.playkit",Te=function(e){var t,a;function n(t,a){var r;return ne(ae(r=e.call(this,"CastPlayer",t,a)||this),"_readyPromise",null),ne(ae(r),"_mediaInfo",null),ne(ae(r),"_firstPlay",!0),ne(ae(r),"_ended",!1),ne(ae(r),"_playbackStarted",!1),ne(ae(r),"_reset",!0),ne(ae(r),"_destroyed",!1),ne(ae(r),"_isOnLiveEdge",!1),Y.load().then((function(){r._initializeCastApi(),r._initializeRemotePlayer()})).catch((function(e){n._logger.error("Cast initialized error",e)})),r}a=e,(t=n).prototype=Object.create(a.prototype),t.prototype.constructor=t,t.__proto__=a,n.isSupported=function(){return"Chrome"===re.browser.name&&"iOS"!==re.os.name};var r,i,s,o=n.prototype;return o.loadMedia=function(e,t){return n._logger.debug("Load media",e,t),this._mediaInfo=e,this._castMedia({mediaInfo:e},t)},o.setMedia=function(e,t){n._logger.debug("Set media",e,t),this._castMedia({mediaConfig:e},t)},o.getMediaInfo=function(){return ce.Object.copyDeep(this._mediaInfo)},o.getMediaConfig=function(){var e={sources:this._playerConfig.sources,plugins:this._playerConfig.plugins};return ce.Object.copyDeep(e)},o.ready=function(){return this._readyPromise?this._readyPromise:Promise.resolve()},o.play=function(){!this.ended||this._adsManager.adBreak?this._engine.play():this._loadOrSetMedia({mediaInfo:this._mediaInfo,mediaConfig:this.getMediaConfig()})},o.pause=function(){this._engine.pause()},o.reset=function(){clearInterval(this._mediaInfoIntervalId),this._reset||(this._reset=!0,this._firstPlay=!0,this._ended=!1,this._isOnLiveEdge=!1,this._tracksManager.reset(),this._engine.reset(),this._adsManager.reset(),this._stateManager.reset(),this._readyPromise=this._createReadyPromise(),this.dispatchEvent(new oe(ie.PLAYER_RESET)))},o.destroy=function(){clearInterval(this._mediaInfoIntervalId),this._destroyed||(this._destroyed=!0,this._firstPlay=!0,this._ended=!1,this._isOnLiveEdge=!1,this._readyPromise=null,this._eventManager.destroy(),this._tracksManager.destroy(),this._engine.destroy(),this._adsManager.destroy(),this._stateManager.destroy(),this.dispatchEvent(new oe(ie.PLAYER_DESTROY)))},o.isLive=function(){var e=this._castRemotePlayer.mediaInfo;return!!e&&e.streamType===chrome.cast.media.StreamType.LIVE},o.isOnLiveEdge=function(){return this._isOnLiveEdge},o.isDvr=function(){if(this.isLive()){var e=this._castSession.getMediaSession();if(e){var t=e.liveSeekableRange;if(t){var a=t.start/60;return t.end/60-a>this._castConfig.liveEdgeThreshold}}}return!1},o.seekToLiveEdge=function(){var e=this._castSession.getMediaSession();if(e){var t=e.liveSeekableRange;t&&(this._engine.currentTime=t.end)}},o.getStartTimeOfDvrWindow=function(){var e=this._castSession.getMediaSession();if(e){var t=e.liveSeekableRange;if(t)return t.start}return 0},o.getTracks=function(e){return this._tracksManager.getTracks(e)},o.getActiveTracks=function(){return this._tracksManager.getActiveTracks()},o.selectTrack=function(e){this._tracksManager.selectTrack(e)},o.hideTextTrack=function(){this._tracksManager.hideTextTrack()},o.startCasting=function(){return cast&&cast.framework?cast.framework.CastContext.getInstance().requestSession():Promise.reject()},o.isCastAvailable=function(){return!!this._castRemotePlayer},o.stopCasting=function(){this._castSession.endSession(!0)},o.getCastSession=function(){return ce.Object.copyDeep(this._remoteSession)},o._initializeCastApi=function(){var e=this,t={};t.receiverApplicationId=this._castConfig.receiverApplicationId||chrome.cast.media.DEFAULT_MEDIA_RECEIVER_APP_ID,t.autoJoinPolicy=this._castConfig.autoJoinPolicy||chrome.cast.AutoJoinPolicy.ORIGIN_SCOPED,n._logger.debug("Init cast API with options",t);var a=cast.framework.CastContext.getInstance();a.setOptions(t),a.addEventListener(cast.framework.CastContextEventType.CAST_STATE_CHANGED,(function(t){var a=new ge(e,t.castState!==cast.framework.CastState.NO_DEVICES_AVAILABLE);e._remoteControl.onRemoteDeviceAvailable(a)}))},o._initializeRemotePlayer=function(){var e=this;this._castContext=cast.framework.CastContext.getInstance(),this._addSessionLifecycleListeners(),this._castRemotePlayer=new cast.framework.RemotePlayer,this._castRemotePlayerController=new cast.framework.RemotePlayerController(this._castRemotePlayer),this._castRemotePlayerController.addEventListener(cast.framework.RemotePlayerEventType.IS_CONNECTED_CHANGED,(function(){e._castRemotePlayer.isConnected?e._setupRemotePlayer():e._setupLocalPlayer()}))},o._setupRemotePlayer=function(){var e=this;n._logger.debug("Setup remote player"),this._castSession=cast.framework.CastContext.getInstance().getCurrentSession(),this._castSession.addMessageListener(Ce,(function(t,a){return e._onCustomMessage(t,a)})),this._tracksManager=new R(this._castRemotePlayer),this._engine=new N(this._castRemotePlayer,this._castRemotePlayerController),this._stateManager=new d(this._castRemotePlayer,this._castRemotePlayerController),this._adsManager=new ee(this),this._ui=new j,this._attachListeners();var t=this._remoteControl.getPlayerSnapshot();this._playerConfig=t.config,this._remoteSession=new fe(this._castSession.getSessionId(),this._castSession.getCastDevice().friendlyName,this._castSession.getSessionState()!==cast.framework.SessionState.SESSION_STARTED);var a=new ye(this,this._remoteSession,this._ui);if(this._remoteControl.onRemoteDeviceConnected(a),!this._remoteSession.resuming||re.browser.major>=73&&"Android"===re.os.name){if(t){var r=this._getLoadOptions(t);this._loadOrSetMedia(t,r)}}else this._resumeSession()},o._loadOrSetMedia=function(e,t){var a=e.mediaInfo,n=e.mediaConfig;a?this.loadMedia(a,t):n&&this.setMedia({sources:e.mediaConfig.sources,plugins:{}},t)},o._castMedia=function(e,t){var a=this;this.reset(),this._remoteControl.getUIWrapper().reset(),this._playbackStarted&&this.dispatchEvent(new oe(ie.CHANGE_SOURCE_STARTED));var n=new chrome.cast.media.MediaInfo,r=new chrome.cast.media.LoadRequest(n);return t&&Object.keys(t).forEach((function(e){"media"!==e?r[e]=t[e]:Object.keys(t.media).forEach((function(e){n[e]=t.media[e]}))})),n.customData=n.customData||{},n.customData.mediaInfo=e.mediaInfo,n.customData.mediaConfig=e.mediaConfig,this._castSession.loadMedia(r).then((function(){return a._onLoadMediaSuccess()}),(function(e){return a._onLoadMediaFailed(e)}))},o._setupLocalPlayer=function(){n._logger.debug("Setup local player");var e=new he(this),t=new pe(this,e);this.pause(),this.destroy(),this._remoteControl.onRemoteDeviceDisconnected(t)},o._createReadyPromise=function(){var e=this;this._readyPromise=new Promise((function(t){e._eventManager.listenOnce(e,ie.TRACKS_CHANGED,(function(){e.dispatchEvent(new oe(ie.MEDIA_LOADED)),t()}))}))},o._attachListeners=function(){var e=this;this._eventManager.listen(this._engine,ie.TIME_UPDATE,(function(t){return e.dispatchEvent(t)})),this._eventManager.listen(this._engine,ie.PAUSE,(function(t){return e._onPause(t)})),this._eventManager.listen(this._engine,ie.PLAY,(function(t){return e.dispatchEvent(t)})),this._eventManager.listen(this._engine,ie.VOLUME_CHANGE,(function(t){return e.dispatchEvent(t)})),this._eventManager.listen(this._engine,ie.MUTE_CHANGE,(function(t){return e.dispatchEvent(t)})),this._eventManager.listen(this._engine,ie.DURATION_CHANGE,(function(t){return e.dispatchEvent(t)})),this._eventManager.listen(this._engine,ie.ENDED,(function(t){return e._onEnded(t)})),this._eventManager.listen(this._engine,ie.SEEKING,(function(t){return e.dispatchEvent(t)})),this._eventManager.listen(this._engine,ie.SEEKED,(function(t){return e.dispatchEvent(t)})),this._eventManager.listen(this._tracksManager,ie.TRACKS_CHANGED,(function(t){return e.dispatchEvent(t)})),this._eventManager.listen(this._tracksManager,ie.TEXT_TRACK_CHANGED,(function(t){return e.dispatchEvent(t)})),this._eventManager.listen(this._tracksManager,ie.VIDEO_TRACK_CHANGED,(function(t){return e.dispatchEvent(t)})),this._eventManager.listen(this._tracksManager,ie.AUDIO_TRACK_CHANGED,(function(t){return e.dispatchEvent(t)})),this._eventManager.listen(this._tracksManager,ie.TEXT_STYLE_CHANGED,(function(t){return e.dispatchEvent(t)})),this._eventManager.listen(this._tracksManager,ie.ERROR,(function(t){return e.dispatchEvent(t)})),this._eventManager.listen(this._stateManager,ie.PLAYER_STATE_CHANGED,(function(t){return e._onPlayerStateChanged(t)}))},o._onPause=function(e){var t=this;this._isOnLiveEdge=!1,this._eventManager.listenOnce(this._engine,ie.PLAY,(function(){t._isOnLiveEdge=!0})),this.dispatchEvent(e)},o._onEnded=function(e){var t=this;this._ended=!0,this.dispatchEvent(e),this._adsManager.allAdsCompleted?this.dispatchEvent(new oe(ie.PLAYBACK_ENDED)):this._eventManager.listenOnce(this,ie.ALL_ADS_COMPLETED,(function(){t.dispatchEvent(new oe(ie.PLAYBACK_ENDED))}))},o._onPlayerStateChanged=function(e){this._ended||(this._stateManager.currentState.type===se.PLAYING&&this.dispatchEvent(new oe(ie.PLAYING)),this.dispatchEvent(e))},o._handleFirstPlay=function(){this._playbackStarted&&this.dispatchEvent(new oe(ie.CHANGE_SOURCE_ENDED)),this.dispatchEvent(new oe(ie.PLAYBACK_START)),this.dispatchEvent(new oe(ie.PLAY)),this.dispatchEvent(new oe(ie.FIRST_PLAY)),this.dispatchEvent(new oe(ie.FIRST_PLAYING)),this.dispatchEvent(new oe(ie.PLAYING)),this.paused&&this.dispatchEvent(new oe(ie.PAUSE)),this._firstPlay=!1,this._playbackStarted=!0},o._resumeSession=function(){var e=this;this._readyPromise=this._createReadyPromise(),this._mediaInfoIntervalId=setInterval((function(){var t=e._castSession.getMediaSession();t&&t.customData&&(clearInterval(e._mediaInfoIntervalId),e._mediaInfo=t.customData.mediaInfo,n._logger.debug("Resuming session with media info",e._mediaInfo),e._onLoadMediaSuccess())}),Ee)},o._onLoadMediaSuccess=function(){n._logger.debug("Load media success"),this._reset=!1,this._triggerInitialPlayerEvents(),this._tracksManager.parseTracks(),this._handleFirstPlay();var e=this._playerConfig.playback.startTime;this.isLive()&&(-1===e||"number"==typeof this.duration&&e>=this.duration-10)&&(this._isOnLiveEdge=!0)},o._triggerInitialPlayerEvents=function(){this.dispatchEvent(new oe(ie.SOURCE_SELECTED,{selectedSource:[{url:this._castRemotePlayer.mediaInfo.contentUrl,mimetype:this._castRemotePlayer.mediaInfo.contentType}]})),this.dispatchEvent(new oe(ie.LOADED_METADATA)),this.dispatchEvent(new oe(ie.ABR_MODE_CHANGED,{mode:ue.AUTO}))},o._onLoadMediaFailed=function(e){n._logger.debug("Load media falied",e),this.dispatchEvent(new oe(ie.ERROR,new de(de.Severity.CRITICAL,de.Category.CAST,de.Code.CAST_LOAD_MEDIA_FAILED,e)))},o._addSessionLifecycleListeners=function(){var e=this;this._castContext.addEventListener(cast.framework.CastContextEventType.SESSION_STATE_CHANGED,(function(t){switch(t.sessionState){case cast.framework.SessionState.SESSION_STARTING:e._remoteControl.onRemoteDeviceConnecting();break;case cast.framework.SessionState.SESSION_RESUMED:re.browser.major>=73&&"Android"===re.os.name&&e._remoteControl.onRemoteDeviceConnecting();break;case cast.framework.SessionState.SESSION_ENDING:e._remoteControl.onRemoteDeviceDisconnecting();break;case cast.framework.SessionState.SESSION_START_FAILED:e._remoteControl.onRemoteDeviceConnectFailed()}}))},o._getLoadOptions=function(e){var t={autoplay:this._playerConfig.playback.autoplay,currentTime:this._playerConfig.playback.startTime,media:{}};if(this.textStyle&&!this.textStyle.isEqual(e.textStyle)&&(t.media.textTrackStyle=ve.toCastTextStyle(e.textStyle)),t.media.customData={audioLanguage:this._playerConfig.playback.audioLanguage,textLanguage:this._playerConfig.playback.textLanguage},e.advertising&&e.advertising.adTagUrl){this._adsController=new W;var a=this._castConfig.advertising;if(a&&a.vast){var n=ce.Generator.uniqueId(5),r=ce.Generator.uniqueId(5),i=[{id:n,position:0,vastAdsRequest:this._getAdsRequest(e.advertising)}],s=[{breakClipIds:[n],id:r,position:0}];t.media.breakClips=i,t.media.breaks=s}else t.media.vmapAdsRequest=this._getAdsRequest(e.advertising)}var o=this._getExternalCaptions();return o.length&&(t.media.tracks=o),t},o._getExternalCaptions=function(){var e=[];return this._playerConfig.sources.captions&&this._playerConfig.sources.captions.length&&this._playerConfig.sources.captions.forEach((function(t,a){var r;"vtt"===t.type||t.url.endsWith(".vtt")?(r=new chrome.cast.media.Track(a+1,chrome.cast.media.TrackType.TEXT),ce.Object.mergeDeep(r,{trackContentId:t.url,trackContentType:"text/vtt",name:t.label,language:t.language}),e.push(r)):n._logger.warn("Text track type "+t.type+" is unsupported by Cast receiver")})),e},o._getAdsRequest=function(e){var t={};return e.adTagUrl&&(t.adTagUrl=e.adTagUrl),e.adsResponse&&(t.adsResponse=e.adsResponse),t},o._onCustomMessage=function(e,t){try{var a=JSON.parse(t);switch(n._logger.debug("Custom message received",a),a.type){case me.EVENT:this._handleCustomEvent(a)}}catch(e){this.dispatchEvent(new oe(ie.ERROR,new de(de.Severity.RECOVERABLE,de.Category.CAST,de.Code.CAST_CUSTOM_MESSAGE_PARSING_ERROR,e)))}},o._handleCustomEvent=function(e){this.dispatchEvent(new oe(e.event,e.payload))},r=n,(i=[{key:"ads",get:function(){return this._adsController}},{key:"textStyle",set:function(e){this._tracksManager.textStyle=e},get:function(){return this._tracksManager.textStyle}},{key:"currentTime",set:function(e){this._engine.currentTime=e},get:function(){return this._engine.currentTime}},{key:"duration",get:function(){return this._engine.duration}},{key:"volume",set:function(e){this._engine.volume=e},get:function(){return this._engine.volume}},{key:"paused",get:function(){return this._engine.paused}},{key:"ended",get:function(){return this._ended}},{key:"seeking",get:function(){return this._engine.seeking}},{key:"muted",set:function(e){this._engine.muted=e},get:function(){return this._engine.muted}},{key:"src",get:function(){return this._castRemotePlayer.mediaInfo?this._castRemotePlayer.mediaInfo.contentUrl:""}},{key:"poster",get:function(){try{return this._castRemotePlayer.mediaInfo.metadata.images[0].url}catch(e){return""}}},{key:"playbackRate",get:function(){var e=this._castSession.getMediaSession();return e?e.playbackRate:null}},{key:"engineType",get:function(){return le.CAST}},{key:"type",get:function(){return n.Type}}])&&te(r.prototype,i),s&&te(r,s),n}(_e);ne(Te,"Type","chromecast"),ne(Te,"defaultConfig",{liveEdgeThreshold:5});var ke=n.cast.registerRemotePlayer,Se="@playkit-js/playkit-js-cast-sender",Ae="1.0.2";Te.isSupported()&&ke(Te.Type,Te)}]);
//# sourceMappingURL=playkit-cast-sender.js.map